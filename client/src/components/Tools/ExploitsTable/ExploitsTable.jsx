import React, { useState, useCallback } from "react";
import { v4 as uuidv4 } from "uuid";
import ExploitTableItem from "./ExploitTableItem";
import FileHistory from "./FileHistory";

import { Box, IconButton, Typography } from "@mui/material";
import AddCircleOutlineIcon from "@mui/icons-material/AddCircleOutline";
import style from "./ExploitsTable.module.css";

const ExploitsTable = React.memo(({ currentLanguage, socket }) => {
  const [exploitTableKeys, setExploitTableKeys] = useState([uuidv4()]);

  const addExploitTable = useCallback(() => {
    setExploitTableKeys((prevKeys) => [...prevKeys, uuidv4()]);
  }, []);

  const handleRemoveExploitTable = useCallback((keyToRemove) => {
    setExploitTableKeys((prevKeys) =>
      prevKeys.filter((key) => key !== keyToRemove)
    );
  }, []);

  return (
    <Box className={style.exploits_table}>
      {exploitTableKeys.map((key, index) => (
        <ExploitTableItem
          key={key}
          currentLanguage={currentLanguage}
          onRemove={() => handleRemoveExploitTable(key)}
          isRemovable={index > 0}
          socket={socket}
        />
      ))}
      <Box className={style.add_exploit_table_container}>
        <IconButton onClick={addExploitTable}>
          <AddCircleOutlineIcon fontSize="large" />
        </IconButton>
        <Typography>
          {currentLanguage === "ENG"
            ? "Add exploit table"
            : "Добавить таблицу с эксплоитами"}
        </Typography>
      </Box>

      <FileHistory currentLanguage={currentLanguage} socket={socket} />
    </Box>
  );
});

export default ExploitsTable;
