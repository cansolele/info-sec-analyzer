import React, { useState } from "react";
import { v4 as uuidv4 } from "uuid";
import ExploitTableItem from "./ExploitTableItem";
import FileHistory from "./FileHistory";

import { Box, IconButton, Typography } from "@mui/material";
import AddCircleOutlineIcon from "@mui/icons-material/AddCircleOutline";
import style from "./ExploitsTable.module.css";

const languageTexts = {
  ENG: "Create another table",
  RU: "Создать ещё таблицу",
};

const ExploitsTable = React.memo(({ currentLanguage, socket }) => {
  const [exploitTableKeys, setExploitTableKeys] = useState([uuidv4()]);

  const addExploitTable = () => {
    setExploitTableKeys((prevKeys) => [...prevKeys, uuidv4()]);
  };

  const handleRemoveExploitTable = (keyToRemove) => {
    setExploitTableKeys((prevKeys) =>
      prevKeys.filter((key) => key !== keyToRemove)
    );
  };

  return (
    <Box className={style.exploits_table}>
      {exploitTableKeys.map((key, index) => (
        <ExploitTableItem
          key={key}
          itemKey={key}
          currentLanguage={currentLanguage}
          onRemove={() => handleRemoveExploitTable(key)}
          isRemovable={index > 0}
          socket={socket}
        />
      ))}
      <Box className={style.add_exploit_table_container}>
        <IconButton onClick={addExploitTable}>
          <AddCircleOutlineIcon fontSize="large" />
        </IconButton>
        <Typography>{languageTexts[currentLanguage]}</Typography>
      </Box>

      <FileHistory currentLanguage={currentLanguage} socket={socket} />
    </Box>
  );
});

export default ExploitsTable;
